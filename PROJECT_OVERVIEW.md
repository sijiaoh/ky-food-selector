# KY点餐系统 - 项目概括

## 项目现状 (截至 2025-01-12)

### 🎯 项目定位
智能菜品选择与点餐系统，根据人数、预算、菜品搭配等约束条件，自动生成满足要求的菜品清单。

### 📊 开发进度
- ✅ **数据层**: 完整的Excel/CSV解析、数据验证、类型定义
- ✅ **界面层**: 现代化文件上传、数据展示、错误处理
- ✅ **业务层**: 约束条件配置界面（已完成）
- ⚠️ **核心算法**: 智能菜品生成算法（待开发）
- ⚠️ **交互层**: 结果展示和手动调整（待开发）

### 🏗️ 架构设计

#### 技术栈
- **前端**: React 19 + TypeScript 5 + Vite 6
- **测试**: Vitest 3 + React Testing Library + 38个测试
- **代码质量**: ESLint + Prettier + 严格TypeScript配置
- **部署**: GitHub Pages + 自动化构建

#### 目录结构核心
```
src/
├── components/          # UI组件
│   ├── features/        # 业务组件 (FileUpload, ConstraintsForm)
│   └── ui/             # 通用组件 (空)
├── services/           # 业务服务 (excel-parser)
├── utils/              # 工具函数 (csv-parser, sample-data, validators)
├── algorithms/         # 核心算法 (空，待开发)
├── hooks/              # 自定义Hooks (空)
├── types/              # 类型定义 (完整的Dish, Constraints等)
└── constants/          # 常量配置
```

#### 数据模型
- **Dish**: 菜品信息（价格、类型、温度、荤素、标签等）
- **Constraints**: 约束条件（人数、预算、类型分布、标签要求等）
- **GenerationResult**: 生成结果（菜品列表、总价、元数据）
- **ParsedFileData**: 文件解析结果（数据、错误、统计信息）

### 🔧 核心功能详解

#### 1. 文件上传与解析 (✅ 完成)
- **支持格式**: CSV, Excel (.xlsx, .xls)
- **解析能力**: 
  - 标准CSV解析 + 引号字段支持
  - 混合标签分隔符（空格 + 逗号）
  - 空值字段处理
  - 实时错误报告
- **用户体验**: 拖拽上传、示例文件下载、加载状态

#### 2. 数据验证 (✅ 完成)
- **菜品验证**: 价格、类型、温度、荤素、标签格式
- **约束验证**: 人数、预算、分布要求、排除条件
- **错误处理**: 行级错误定位、批量错误报告

#### 3. 数据展示 (✅ 完成)
- **概览统计**: 总行数、有效菜品、解析时间
- **完整表格**: 8字段全显示、响应式设计
- **标签展示**: 彩色徽章、多标签支持
- **错误报告**: 详细错误列表、用户友好提示

#### 4. 约束条件配置 (✅ 完成)
- **基础设置**: 人数、预算输入与实时验证
- **菜品搭配**: 五大类型数量配置（主食、主菜、副菜、汤、点心）
- **智能提示**: 菜品总数统计、预算建议、警告提示
- **预设配置**: 三种典型场景（家庭聚餐、商务宴请、简单聚会）
- **配置保存**: 用户自定义配置保存功能

### 🎨 UI/UX 设计原则

#### 视觉设计
- **色彩系统**: Bootstrap色板（主色#007bff，危险#dc3545）
- **布局**: 卡片式分区、清晰的信息层次
- **响应式**: Mobile-first设计，支持320px-4K屏幕

#### 交互设计
- **渐进式披露**: 数据上传 → 验证 → 展示 → 配置 → 生成
- **即时反馈**: 文件拖拽、悬停效果、错误提示
- **无障碍**: ARIA标签、键盘导航支持

### 📋 数据格式规范

#### CSV格式示例
```csv
菜名,价格,类型,温度,荤素,标签,基础个数,根据人数加量
白米饭,3,主食,热,素,"米饭,主食",1,Yes
红烧肉,38,主菜,热,荤,猪肉 红烧 下饭,1,No
凉拌黄瓜,8,副菜,,素,黄瓜 爽脆 清淡,1,
```

#### 字段说明
- **必填**: 菜名、价格、类型、基础个数
- **可选**: 温度、荤素、标签、根据人数加量
- **标签**: 支持空格或逗号分隔，引号包围
- **空值**: 空字符串或不填写

### 🧪 测试策略

#### 测试覆盖 (23个测试)
- **单元测试**: CSV解析器、数据验证器
- **集成测试**: Excel解析流程、示例数据验证
- **组件测试**: FileUpload交互、错误状态

#### 质量保证
- **类型安全**: 严格TypeScript配置，禁止any
- **代码规范**: ESLint + Prettier自动格式化
- **Git工作流**: 单引号提交信息、TDD开发流程

### 🚀 下一阶段开发计划

#### Phase 1: 约束条件配置 (已完成)
- ✅ **约束条件输入表单组件**: 完整的基础设置和菜品类型配置
- ✅ **实时约束验证和提示**: 数据验证、警告提示、预算建议
- ✅ **预设配置和保存功能**: 家庭聚餐、商务宴请、简单聚会三种预设

#### Phase 2: 智能生成算法 (预计2-3周)
- [ ] 贪心算法 + 动态规划优化
- [ ] 约束求解引擎 (O(n log n)复杂度)
- [ ] 多目标优化 (预算、类型、荤素平衡)

#### Phase 3: 结果交互 (预计1-2周)
- [ ] 生成结果展示
- [ ] 手动调整 (固定菜品、替换菜品)
- [ ] 重新生成和导出功能

#### 📋 文档维护自动化 (已完成)
- ✅ **CLAUDE.md配置**: 添加文档维护自动化指导
- ✅ **同步机制**: 建立开发工作与文档更新的触发机制
- ✅ **检查清单**: 提供文档同步的具体操作步骤

#### 🎛️ 约束条件配置功能 (已完成)
- ✅ **表单组件架构**: TDD开发，15个专项测试覆盖
- ✅ **用户体验优化**: 实时验证、智能提示、预设配置
- ✅ **功能完整性**: 基础设置、类型搭配、预算建议、配置保存

### 📝 技术债务和改进点

#### 当前技术债务
- [ ] 缺少Storybook组件文档
- [ ] 需要添加E2E测试
- [ ] 性能优化：大数据集虚拟化

#### 架构改进机会
- [ ] 状态管理：考虑Zustand或Context
- [ ] 错误边界：添加全局错误处理
- [ ] PWA支持：离线功能和安装提示

### 🔍 关键设计决策记录

#### 1. 为什么选择表格而非卡片显示？
- **问题**: 原网格卡片省略信息，占用空间大
- **决策**: 改用紧凑表格，显示全部8个字段
- **效果**: 信息密度提升，用户体验改善

#### 2. 为什么支持混合标签分隔符？
- **问题**: 用户可能从Excel复制含逗号的标签
- **决策**: 同时支持空格和引号+逗号格式
- **实现**: 自定义CSV解析器处理引号字段

#### 3. 为什么采用TDD开发模式？
- **原因**: 确保代码质量和重构安全性
- **实践**: 先写测试再写代码，23个测试覆盖
- **收益**: 重构信心足、bug率低

### 📞 维护者备注

#### 开发环境设置
```bash
npm install          # 安装依赖
npm run dev         # 启动开发服务器
npm test            # 运行测试
npm run typecheck   # 类型检查
npm run lint        # 代码检查
```

#### 常见问题解决
- **CSV解析错误**: 检查引号配对和字段数量
- **TypeScript错误**: 注意严格模式和可选属性
- **测试失败**: 确保mock数据格式正确

#### 代码风格要求
- Git提交信息只能使用单引号
- 禁止使用any类型
- 组件prop要有明确类型定义
- 测试必须覆盖主要业务逻辑

---

**最后更新**: 2025-01-13  
**维护者**: Claude Code AI  
**项目版本**: v1.0.0-alpha  
**下次更新**: 智能菜品生成算法完成后